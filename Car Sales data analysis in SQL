
--USA CAR SALES--

--This dataset was downloaded from Kaggle.com--
--The data is clean and it has been used with the objective of practicing and enhancing my SQL skills--
--In this small project, I will gain insights and answer questions generated by myself.--




1. Which are the top 10 manufacturers by sales volume?
2. How many models do each manufacturer produce?
3. What are the types of vehicles? How many models do each type include and what is the average price per type?
4. Find the manufacturers and models with the highest and lowest depreciation rates.
5. Organize the fuel distribution data based on vehicle numbers.
6. What is the average vehicle manufacturer price?
7. Identify the manufacturer with the most significant market share.
8. Find the price gap between the least expensive and most costly models within each manufacturer's lineup.
9. Compute the average horsepower of each manufacturer.
10. Display the correlation between fuel efficiency and the price of vehicles.

--  Create a visualization chart for each step  .--


--------------------------------------------------------------------------------------------------------------------------------------------------------



--inspecting dataset--

SELECT *
FROM car_sales

SELECT Count(*)
FROM car_sales

SELECT Count(*) 
FROM information_schema.columns
WHERE table_name = 'car_sales'

-- There are 157 entries in the database and 16 columns


--find top manufacturer by sales--

WITH top_sales as (
SELECT manufacturer, CAST(Sum(sales_in_thousands) AS decimal (10,3)) AS total_sales, RANK()OVER(Order by Sum(sales_in_thousands) desc) AS rnk
FROM car_sales
Group by manufacturer
)

SELECT manufacturer, total_sales 
FROM top_sales 
WHERE rnk <= 10


--model distribution--

SELECT manufacturer, COUNT(*)
FROM car_sales
Group by manufacturer





--distribution and average price of vehicle type--


SELECT vehicle_type, Count(*) AS no_vehicles
FROM car_sales
Group by vehicle_type

SELECT vehicle_type,CAST(AVG(price_in_thousands) AS decimal (10,3)) AS average_price, Count(*) AS no_vehicles
FROM car_sales
Group by vehicle_type




--highest model depreciation--
WITH depreciation AS (
    SELECT
        manufacturer, model,
        Sum(price_in_thousands) AS total_value,
        Sum(price_in_thousands) - Sum(year_resale_value) AS total_depreciation,
		Rank() Over (Order by  Sum(price_in_thousands) - Sum(year_resale_value)  DESC) AS rnk
    From
        car_sales
    Where
        price_in_thousands IS NOT NULL AND year_resale_value IS NOT NULL
    Group by
        manufacturer, model
)
SELECT
    manufacturer, model,
    Cast(total_depreciation AS DECIMAL (10,3)) AS total_depreciation,
    Cast((total_depreciation / total_value) * 100 AS DECIMAL(10, 3)) AS percentage_depreciation
	
From
    depreciation
	Where rnk <= 20


-- lowest depreciation rate --
WITH depreciation AS (
    SELECT
        manufacturer, model,
        Sum(price_in_thousands) AS total_value,
        Sum(price_in_thousands) - Sum(year_resale_value) AS total_depreciation,
		Rank() Over (Order by  Sum(price_in_thousands) - Sum(year_resale_value) ) AS rnk
    From
        car_sales
    Where
        price_in_thousands IS NOT NULL AND year_resale_value IS NOT NULL
    Group by
        manufacturer, model
)
SELECT
    manufacturer, model,
    Cast(total_depreciation AS DECIMAL (10,3)) AS total_depreciation,
    Cast((total_depreciation / total_value) * 100 AS DECIMAL(10, 3)) AS percentage_depreciation
	
From
    depreciation
	Where rnk <= 20



	
--distribution of fuel efficiency--

SELECT fuel_efficiency, Count(*) AS no_vehicles
FROM car_sales 
Where fuel_efficiency IS NOT NULL
Group by fuel_efficiency





--average vehicle price per manufacturer--

SELECT manufacturer, CAST(AVG(price_in_thousands)AS decimal(10,3)) AS avg_price
FROM car_sales 
Group by manufacturer


--manufacturer market share --


WITH manufacture_revenue AS (
   SELECT manufacturer, CAST(Sum(sales_in_thousands * price_in_thousands)AS decimal (10,3)) AS revenue
	FROM car_sales
	Group by manufacturer

)

SELECT
    manufacturer,revenue,
    CAST((revenue / (SELECT Sum(revenue) FROM manufacture_revenue)) * 100 AS decimal (10,3)) AS market_share
FROM manufacture_revenue
    
Order by market_share desc



--difference between max and min price --


WITH price_diff AS (
SELECT manufacturer, CAST(MAX(price_in_thousands) AS DECIMAL(10, 3)) AS max_price, CAST(MIN(price_in_thousands) AS DECIMAL(10, 3)) AS min_price
FROM car_sales 
Where price_in_thousands IS NOT NULL
Group by manufacturer)

SELECT manufacturer, max_price - min_price AS difference
FROM price_diff
Order by difference DESC



--average horsepower by manufacturer--


SELECT manufacturer, AVG(horsepower) AS avg_horsepower
FROM car_sales
Group by manufacturer

-- replaced null value in horsepower with average of column --
DECLARE @average smallint
SELECT @average = AVG(horsepower)
FROM car_sales
WHERE horsepower IS NOT NULL

UPDATE car_sales
SET horsepower = Coalesce(horsepower, @average)



--price to fuel efficiency--


SELECT CAST(price_in_thousands AS decimal(10,3)) AS price_in_thousands, fuel_efficiency
FROM car_sales 
WHERE price_in_thousands IS NOT NULL AND fuel_efficiency IS NOT NULL


